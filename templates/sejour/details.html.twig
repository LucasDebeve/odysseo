{% extends 'navbase.html.twig' %}

{% block title %}Odysseo - Pilotage{% endblock %}

{% block content %}
<header class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
    <div>
        <h1 class="text-3xl font-black tracking-tighter text-primary italic">Dashboard<span class="text-golden">.</span></h1>
        <p class="text-xs text-gray-400 font-bold uppercase tracking-widest mt-1">Pilotage en temps réel</p>
    </div>
</header>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    {% set diff = date().diff(sejour.dateDebut) %}
    {% if diff.invert == 1 %}
        {% set avanceStr = 'J' ~ (diff.days + 1) %}
    {% else %}
        {% if diff.days == 0 %}
            {% set avanceStr = 'J1' %}
        {% else %}
            {% set avanceStr = 'J-' ~ diff.days %}
        {% endif %}
    {% endif %}

    {{ include('sejour/partials/_sejour_stat_card.html.twig', {label: 'Enfants', val: sejour.enfants|length, color: 'bg-blue-50', icon: 'lucide:users'}) }}
    {{ include('sejour/partials/_sejour_stat_card.html.twig', {label: 'Animateurs', val: sejour.equipe|length, color: 'bg-purple-50', icon: 'lucide:user-cog'}) }}
    {{ include('sejour/partials/_sejour_stat_card.html.twig', {label: 'Avancée', val: avanceStr, color: 'bg-amber-50', icon: 'lucide:calendar-clock'}) }}
</div>

<div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-stretch mb-6">
    
    <div id="card-team" class="md:col-span-8 transition-all duration-500 ease-in-out">
        <div class="bg-white rounded-[2rem] border border-gray-100 shadow-sm overflow-hidden h-full flex flex-col">
            <div class="p-6 flex items-center justify-between border-b border-gray-50">
                <h3 class="font-bold flex items-center gap-2">
                    <span class="w-2 h-2 bg-primary rounded-full"></span> Équipe d'animation
                </h3>
                <button onclick="toggleLayout()" class="p-2 bg-gray-50 text-gray-400 hover:text-primary hover:bg-primary/5 rounded-xl transition-all cursor-pointer group">
                    <div id="toggle-icon" class="transition-transform duration-500">
                        {{ ux_icon('lucide:arrow-left-right', { class: 'w-5 h-5' }) }}
                    </div>
                </button>
            </div>
            
            <div class="p-6 flex-grow">
                <div id="team-grid" class="grid grid-cols-2 sm:grid-cols-4 gap-4 transition-all duration-300">
                    {% for animateur in sejour.equipe %}
                    <a href="{{ path('app_profile', {id: animateur.id}) }}" class="flex flex-col items-center p-4 bg-gray-50 rounded-2xl border border-transparent hover:border-primary/20 hover:bg-white transition-all">
                        <img src="{{ asset('/uploads/avatar/' ~ animateur.avatarPath|default('default.jpg')) }}" class="w-12 h-12 object-cover rounded-xl mb-2 shadow-inner">
                        <span class="text-[10px] font-bold text-gray-600 uppercase">
                            {{ animateur.prenom }} {{ animateur.nom|slice(0, 1)|upper }}.
                        </span>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div id="card-alerts" class="md:col-span-4 transition-all duration-500 ease-in-out">
        <div class="bg-white rounded-[2rem] border border-gray-100 shadow-sm overflow-hidden h-full flex flex-col">
            <div class="p-6 border-b border-gray-50">
                <h3 class="font-bold text-red-600 flex items-center gap-2 uppercase text-sm tracking-tighter">
                    <span class="relative flex h-2 w-2">
                        <span class="animate-ping absolute h-full w-full rounded-full bg-red-400 opacity-75"></span>
                        <span class="relative rounded-full h-2 w-2 bg-red-500"></span>
                    </span>
                    Alertes Critiques
                </h3>
            </div>
            
            <div class="p-6 space-y-4 flex-grow">
                {% for i in 1..2 %}
                <div class="relative group">
                    <div class="absolute -inset-0.5 bg-red-500 rounded-2xl blur opacity-10 animate-pulse group-hover:opacity-25 transition-opacity"></div>
                    <div class="relative bg-[#FFF5F5] p-5 rounded-2xl border border-white flex flex-col gap-1 shadow-sm">
                        <p class="text-[10px] font-black text-red-500 uppercase tracking-widest">Sécurité</p>
                        <p class="text-xs font-bold text-gray-800 leading-tight">Le taux d'encadrement n'est pas respecté sur le groupe 6-8 ans.</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
<div class="w-full">
    <div class="bg-white rounded-[2rem] border border-gray-100 shadow-sm overflow-hidden">
        <div class="p-6 border-b border-gray-50 flex justify-between items-center">
            <h3 class="font-bold italic">To-do list<span class="text-golden">.</span></h3>
            <span class="px-3 py-1 bg-gray-100 rounded-full text-[10px] font-bold text-gray-500 uppercase">4 tâches</span>
        </div>
        <div class="p-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            {% for i in 1..4 %}
            <label class="group cursor-pointer flex items-start gap-4 p-4 bg-gray-50 rounded-2xl border-2 border-transparent hover:border-primary/10 hover:bg-white transition-all">
                <div class="relative mt-1">
                    <input type="checkbox" class="peer hidden">
                    
                    <div class="w-9 h-5 bg-gray-200 rounded-full transition-colors duration-300 peer-checked:bg-green-500"></div>
                    
                    <div class="absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-all duration-300 peer-checked:translate-x-4 shadow-sm"></div>
                </div>

                <div class="flex flex-col">
                    <span class="text-xs font-bold group-hover:text-primary transition-colors uppercase tracking-tight peer-checked:line-through peer-checked:text-gray-400">
                        Appeler les parents (D. Enzo)
                    </span>
                    <span class="text-[10px] text-gray-400 font-medium">Urgences • Avant 18h</span>
                </div>
            </label>
            {% endfor %}
        </div>
    </div>
</div>

<script>
/**
 * Alterne entre deux configurations de grille :
 * Mode A: Team 8 / Alerts 4
 * Mode B: Team 4 / Alerts 8
 */
function toggleLayout() {
    const cardTeam = document.getElementById('card-team');
    const cardAlerts = document.getElementById('card-alerts');
    const teamGrid = document.getElementById('team-grid');
    const icon = document.getElementById('toggle-icon');

    const isTeamLarge = cardTeam.classList.contains('md:col-span-8');

    if (isTeamLarge) {
        // RÉDUIRE TEAM / AGRANDIR ALERTS
        cardTeam.classList.replace('md:col-span-8', 'md:col-span-4');
        cardAlerts.classList.replace('md:col-span-4', 'md:col-span-8');
        teamGrid.classList.replace('sm:grid-cols-4', 'sm:grid-cols-2');
        icon.style.transform = 'rotate(180deg)';
    } else {
        // AGRANDIR TEAM / RÉDUIRE ALERTS
        cardTeam.classList.replace('md:col-span-4', 'md:col-span-8');
        cardAlerts.classList.replace('md:col-span-8', 'md:col-span-4');
        teamGrid.classList.replace('sm:grid-cols-2', 'sm:grid-cols-4');
        icon.style.transform = 'rotate(0deg)';
    }
}
</script>
{% endblock %}